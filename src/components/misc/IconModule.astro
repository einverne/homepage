---
import path from "path";
import { Icon } from "astro-icon/components";

interface Props {
    icon: string;
    size?: number;
    color?: string;
}

const { icon, size, color } = Astro.props;

// 如果 icon 以.svg 结尾，则直接使用 icon
const isLocal = icon.endsWith(".svg");

let SvgComponent;
if (isLocal) {
    const svgs = import.meta.glob("../../**/*.svg");
    let svgPath = path.normalize(path.join("../../", "/", icon)).replace(/\\/g, "/");
    const svgModule = svgs[svgPath];
    if (!svgModule) {
        console.error(`\n[ERROR] [IconModule] ${icon} not found`);
    } else {
        console.log(`\n[INFO] [IconModule] ${icon} found`);
        const module = await svgModule();
        SvgComponent = module.default;
    }
}
---

{isLocal && SvgComponent && 
  <SvgComponent width={size} height={size} fill={color} />
}
{!isLocal &&
  <Icon name={icon} size={size || 25} style={`color: ${color}`} />
}