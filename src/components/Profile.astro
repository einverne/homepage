---
import path from 'path'
import { profileConfig } from "../config";
import { Image } from 'astro:assets';
import ImageModule from "./misc/ImageModule.astro"
import IconModule from './misc/IconModule.astro'
import { getRelativeLocaleUrl } from 'astro:i18n';
import { getLocale, getTranslations } from '@/utils/i18n';

const config = profileConfig;
const locale = getLocale(Astro.currentLocale);
const t = getTranslations(locale);
const localizeUrl = (targetUrl: string) => {
    if (targetUrl.startsWith('/')) {
        return getRelativeLocaleUrl(locale, targetUrl.replace(/^\//, ''));
    }
    return targetUrl;
};

const isPureBlack = (color?: string) => {
    if (!color) return false;
    const normalized = color.trim().toLowerCase();
    if (normalized === "black") return true;
    if (normalized === "#000" || normalized === "#000000" || normalized === "#000000ff") return true;
    if (normalized.startsWith("rgb")) {
        const values = normalized.replace(/rgba?\(|\)/g, "").split(",").map((value) => value.trim());
        if (values.length >= 3) {
            return values[0] === "0" && values[1] === "0" && values[2] === "0";
        }
    }
    return false;
};

import img from "../assets/avatar.jpg"
---

<div class="profile">
    <div class="avatar">
        <ImageModule src={profileConfig.avatar} alt="avator" class="image"/>
    </div>
    <div class="text">
        <div class="name">{config.name}</div>
        <div class="discription">{t.profile.description}</div>
    </div>

    <div class="links">
        {config.links.map((item) => {
            const isBlack = isPureBlack(item.color);
            const linkClass = isBlack ? "link is-black" : "link";
            const linkStyle = item.color && !isBlack ? `--link-icon-color: ${item.color}` : undefined;
            const iconColor = item.color ? "var(--link-icon-color)" : undefined;
            return (
                <div class={linkClass} style={linkStyle}>
                    <a
                      href={localizeUrl(item.url)}
                      {...item.url.startsWith('/')
                        ? {}
                        : { target: "_blank", rel: "noreferrer" }}
                      data-title={item.name}
                    >
                        <IconModule icon={item.icon} size={25} color={iconColor}/>
                    </a>
                </div>
            );
        })}
    </div>
</div>

<style>
.profile {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    flex: 1;
    width: 100%;
    padding: 20px 0;
    margin-top: 25vh;
}
.text{
    display: block;
    text-align: center;
    margin-top: 10px;
    /* font-family: 'Delius'; */
}

.text .name{
    font-size: 1.5rem;
    /* font-weight: bold; */
    margin-bottom: 0.5rem;
    
}
.text .discription{ 
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    color: var(--motto-text-color);
}
.links{ 
    border-top: var(--border-color) solid 1px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    gap: 12px;
    padding-inline: 12px;
    max-width: 100%;
    box-sizing: border-box;
}
.links div {
    margin: 0;
}

/* 自定义提示框样式 */
.link {
    position: relative;
    --link-icon-color: currentColor;
}

.link a {
    position: relative;
    display: inline-block;
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.link a:hover {
    opacity: 1;
}

.link.is-black {
    --link-icon-color: #000;
}

:global([data-theme="dark"]) .link.is-black {
    --link-icon-color: var(--link-color);
}

.link a::after {
    content: attr(data-title);
    position: absolute;
    bottom: -40px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 14px;
    white-space: normal;
    max-width: min(70vw, 220px);
    text-align: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 10;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.link a:hover::after {
    opacity: 1;
    visibility: visible;
}
</style>

<!-- ImageModule 的 css 样式需要设置为 is:global 才能应用 -->
<style is:global>
.avatar {
    display: block;
    text-align: center;
}
.avatar .image{
    width: 100px !important;
    height: 100px !important;
    border-radius: 50%;
    overflow: hidden;
    box-shadow: 0 4px 20px var(--image-shadow-color);
    cursor: pointer;
    transition: transform 0.6s ease-in-out;
}

.avatar .image.rotating {
    animation: spin 0.6s ease-in-out;
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const avatar = document.querySelector('.avatar .image');
    if (avatar) {
        avatar.addEventListener('click', () => {
            avatar.classList.add('rotating');
            setTimeout(() => {
                avatar.classList.remove('rotating');
            }, 600);
        });
    }
});
</script>
